#!/usr/bin/env node
/**
 * 构建脚本：将 HTML 模板转换为 TypeScript 模块
 */

const fs = require('fs');
const path = require('path');

const templatesDir = path.join(__dirname, 'templates');
const outputDir = path.join(__dirname, 'html');

// 确保输出目录存在
if (!fs.existsSync(outputDir)) {
  fs.mkdirSync(outputDir, { recursive: true });
}

// 读取所有 HTML 文件并转换为 TypeScript 模块
const htmlFiles = fs.readdirSync(templatesDir).filter(f => f.endsWith('.html'));

htmlFiles.forEach(file => {
  const htmlPath = path.join(templatesDir, file);
  const htmlContent = fs.readFileSync(htmlPath, 'utf-8');

  // 生成 TypeScript 文件名（使用 _html.ts 后缀，避免 Cloudflare Workers 打包工具混淆）
  const tsFileName = file.replace('.html', '_html.ts');
  const tsPath = path.join(outputDir, tsFileName);

  // 生成 TypeScript 内容
  const constName = file.replace('.html', '').replace(/-./g, s => s[1].toUpperCase()).toUpperCase() + '_HTML';
  const tsContent = `// Auto-generated from templates/${file}
// Do not edit this file directly

export const ${constName} = \`${htmlContent.replace(/`/g, '\\`').replace(/\$/g, '\\$')}\`;
`;

  // 写入 TypeScript 文件
  fs.writeFileSync(tsPath, tsContent, 'utf-8');
  console.log(`✅ Generated: ${tsPath}`);
});

console.log('\n✨ Build complete!');
